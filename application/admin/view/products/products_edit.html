<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>编辑商品</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" type="text/css" href="__STATIC__/admin/common/layui/css/layui.css" media="all">
	<link rel="stylesheet" type="text/css" href="__STATIC__/admin/common/bootstrap/css/bootstrap.css" media="all">
	<link rel="stylesheet" type="text/css" href="__STATIC__/admin/common/global.css" media="all">
	<link rel="stylesheet" type="text/css" href="__STATIC__/admin/css/personal.css" media="all">
</head>

<body class="childrenBody" style="padding:10px;background-color:#fff">
	<form class="layui-form">
		<div class="layui-form-item">
			<label class="layui-form-label">Title</label>
			<div class="layui-input-block">
				<input class="layui-input newsName" lay-verify="required" name="title"
					placeholder="Please enter the title of the item." type="text" value="{$data.title}">
			</div>
		</div>
		<div class="layui-form-item">
			<div class="layui-inline">
				<label class="layui-form-label">Price</label>
				<div class="layui-input-inline">
					<input class="layui-input newsAuthor" lay-verify="required|number" placeholder="" type="text" name="price"
						value="{$data.price}">
				</div>
			</div>
			<div class="layui-inline">
				<label class="layui-form-label">ASIN</label>
				<div class="layui-input-inline">
					<input class="layui-input newsAuthor" lay-verify="required" placeholder="" type="text" name="ASIN"
						value="{$data.ASIN}">
				</div>
			</div>
			<!-- <div class="layui-inline">		
				<label class="layui-form-label">CreateDate</label>
				<div class="layui-input-inline">
					<input class="layui-input newsTime" lay-verify="required|date" onClick="layui.laydate({elem:this})" type="text">
				</div>
			</div> -->
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">Image</label>
			<div class="layui-input-block">
				<!-- 点击上传图片 -->
				<div class="layui-input-inline" style="cursor:pointer;" id="cover">
					<img id="preview" style="max-height: 180px; border: #666 solid 2px" src="__STATIC__/{$data.img_url}">
				</div>
				<input type="text" style="display:none" name="img_url" id="img_url" value="{$data.img_url}">
				<input type="text" style="display:none" name="product_id" id="product_id" value="{$data.product_id}">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">Description</label>
			<div class="layui-input-block">
				<textarea rows="3" class="layui-textarea" name="description">{$data.description}</textarea>
			</div>
		</div>
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button class="layui-btn" lay-submit="" lay-filter="submit" id="submit">Submit</button>
				<button type="reset" class="layui-btn layui-btn-primary">Reset</button>
			</div>
		</div>
	</form>
	<!-- <script type="text/javascript" src="__STATIC__/admin/common/layui/layui.js"></script> -->
	<script src="__STATIC__/layui/layui.js"></script>
	<!-- <script type="text/javascript" src="__STATIC__/admin/js/newsadd.js"></script> -->
	<script>
		layui.use(['upload', 'form'], function () {
			var form = layui.form;
			//各种基于事件的操作，下面会有进一步介绍
			var loading;
			var upload = layui.upload;
			var $ = layui.jquery;
			var uploadInst = upload.render({
				elem: '#cover',
				url: '{:url("admin/products/uploadImg")}',
				accept: 'file' // 允许上传的文件类型
					,
				auto: true // 自动上传
					,
				before: function (obj) {
						console.log(obj);
						// 上传等待loading动画
						loading = layer.load(2);
						// 在上传图片的过程中不能点提交按钮
						$('#submit').addClass('layui-btn-disabled');
						// 预览
						obj.preview(function (index, file, result) {
							// console.log(file.name);    //图片名字
							// console.log(file.type);    //图片格式
							// console.log(file.size);    //图片大小
							// console.log(result);       //图片地址
							$('#preview').attr('src', result); //图片链接 base64
						});
						// layer.load();
					}
					// 上传成功回调
					,
				done: function (res) {
						// console.log(upload);
						// console.log(res);

						// 关闭loading动画
						layer.close(loading);
						// 在隐藏的input里面填写上传的图片地址
						$('#img_url').val(res.savename);
						// 获取到图片地址后可以继续提交
						$('#submit').removeClass('layui-btn-disabled');
						if (res.code == 0) {
							return layer.msg(res.msg);
						}
						return layer.msg(res.msg);
					}
					// 上传失败回调
					,
				error: function (index, upload) {
					return layer.msg(res.msg);
				}

			});

			// 表单提交
			form.on('submit(submit)', function (data) {
				$.ajax({
					url: './editItem',
					method: 'post',
					data: data.field,
					dataType: 'JSON',
					success: function (res) {
						console.log('res :', res);
						if (res) {
							// return layer.msg('Successful add a item!',{icon:1,time:2000});
							var message = 'Successful edit the item!';
							layer.confirm(message, {
								icon: 3,
								title: '信息提示'
							}, function (index) {
								//submitForm();  
								layer.close(index);
								var frame_index = parent.layer.getFrameIndex(window.name);
								parent.layer.close(frame_index);
								parent.layui.table.reload('idTest', {})
							});
						} else {
							return layer.msg('Add failed.', {
								icon: 2,
								time: 2000
							});
						}
					},
					error: function (data) {

					}
				});
				return false;
			});
	});
	
	</script>
</body>

</html>